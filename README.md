# Leptos Todo App SurrealDB with Axum

This example creates a basic todo app with an Axum backend that uses Leptos' server functions to call SurrealDB from the client and seamlessly run it on the server. The project basis is the [Leptos Todo App Sqlite with Axum](https://github.com/leptos-rs/leptos/tree/7306ecccbc2c9aad7554ed900a54e5a5335f0b29/examples/todo_app_sqlite_axum) from the [gbj/leptos][leptos_repo] GitHub repository.

## Getting started with SurrealDB

To get started, you'll need to have Docker installed on your device first and then execute the following commands:

```bash
docker compose pull
docker compose up -d
```

This will start SurrealDB on port 8000. You can stop SurrealDB with: 
```bash
docker compose stop
```

In case you prefer to install SurrealDB directly onto your system instead of using Docker, you have the option to do so. For additional information and instructions regarding the installation process, please refer to the [SurrealDB documentation](https://surrealdb.com/docs/installation). After the installation, you may need to set several parameters as environment variables, e.g.:

```bash
SURREALDB_SERVER=127.0.0.1 SURREALDB_PORT=8000 SURREALDB_USERNAME=root SURREALDB_PASSWORD=root SURREALDB_NS=leptos_examples SURREALDB_DB=todos cargo leptos watch
```
These variables indicate the server address, port, username, password, namespace, and database respectively. If you are using this example with Docker, you don't need to set these variables as they are already set in the `docker-compose.yml` file.

## Client Side Rendering
This example cannot be built as a trunk standalone CSR-only app. Only the server may directly connect to the database.

## Server Side Rendering with cargo-leptos
cargo-leptos is now the easiest and most featureful way to build server side rendered apps with hydration. It provides automatic recompilation of client and server code, wasm optimisation, CSS minification, and more! Check out more about it [here](https://github.com/akesson/cargo-leptos)

1. Install cargo-leptos
```bash
cargo install --locked cargo-leptos
``` 
2. Build the site in watch mode, recompiling on file changes
```bash
cargo leptos watch
```

Open browser on [http://localhost:3000/](http://localhost:3000/)

3. When ready to deploy, run
```bash
cargo leptos build --release
```

## Server Side Rendering without cargo-leptos
To run it as a server side app with hydration, you'll need to have wasm-pack installed.

0. Edit the `[package.metadata.leptos]` section and set `site-root` to `"."`. You'll also want to change the path of the `<StyleSheet / >` component in the root component to point towards the CSS file in the root. This tells leptos that the WASM/JS files generated by wasm-pack are available at `./pkg` and that the CSS files are no longer processed by cargo-leptos. Building to alternative folders is not supported at this time. You'll also want to edit the call to `get_configuration()` to pass in `Some(Cargo.toml)`, so that Leptos will read the settings instead of cargo-leptos. If you do so, your file/folder names cannot include dashes.
1. Install wasm-pack
```bash
cargo install wasm-pack
```
2. Build the Webassembly used to hydrate the HTML from the server
```bash
wasm-pack build --target=web --debug --no-default-features --features=hydrate
```
3. Run the server to serve the Webassembly, JS, and HTML 
```bash
cargo run --no-default-features --features=ssr
```

## Testing

This example includes quality checks and end-to-end testing.

To get started install Chromedriver for your platform. 
E.g. on macOS with Homebrew. We need to remove the quarantine attribute from the binary.

```bash
brew install --cask 
xattr -d com.apple.quarantine $(which chromedriver)
```

To get started run this once.

```bash
cargo install cargo-make
cargo make ci
```

To only run the UI tests...

```bash
cargo make start-webdriver
cargo leptos watch # or cargo run...
cargo make test-ui
```

_See the [E2E README](./e2e/README.md) for more information about the testing strategy._

## Credits

All credit for this example goes to 
authors and contributors of [gbj/leptos][leptos_repo] GitHub repository, 
[MIT License][leptos_license], Copyright 2022 Greg Johnston.

[leptos_repo]: https://github.com/gbj/leptos
[leptos_nightly_note]: https://github.com/gbj/leptos#nightly-note
[leptos_license]: https://github.com/gbj/leptos/blob/e465867b30db8fccce7493f9fc913359246ac4bd/LICENSE